!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports["hyperbox-js"]=t():e["hyperbox-js"]=t()}(this,(function(){return(()=>{"use strict";var e={d:(t,n)=>{for(var o in n)e.o(n,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:n[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function r(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}e.r(t),e.d(t,{default:()=>O});var a=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n;return t=e,n=[{key:"BuildPrefixedFunctionName",value:function(t,n){var o=e.CapitalizeFirstLetter(n);return"".concat(t).concat(o)}},{key:"BuildSetterName",value:function(t){return e.BuildPrefixedFunctionName("set",t)}},{key:"BuildGetterName",value:function(t){return e.BuildPrefixedFunctionName("get",t)}},{key:"CapitalizeFirstLetter",value:function(e){if(e&&e.length){var t=e[0].toUpperCase();return"".concat(t).concat(e.substr(1,e.length))}return e}},{key:"LoadJSON",value:function(e){return new Promise((function(t){var n=new XMLHttpRequest;n.overrideMimeType("application/json"),n.open("GET",e,!0),n.onreadystatechange=function(){console.log("request args",n.readyState,n.status),4===n.readyState&&200===n.status&&t(JSON.parse(n.response))},n.send(null)}))}},{key:"DisplayBox",value:function(t){if(t&&"function"==typeof t.display){t._parentBox&&t._parentBox.detectBoxChanges(),e.LoadDOMAttributes(t);var n=t.display(t);t.innerHTML=n,t._init&&"function"==typeof t.boxOnRedisplayed&&t.boxOnRedisplayed()}}},{key:"BuildBoxInterfaces",value:function(t){if(t){var n=t.constructor._BoxInterface;n&&(e.BuildBoxInputs(t,n.Inputs||{}),n.Outputs&&e.BuildBoxOutputs(t,n.Outputs))}}},{key:"BuildBoxInputs",value:function(t,n){var r=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({_parentBoxId:null},n);Object.keys(r).forEach((function(n){var o=e.BuildSetterName(n),i=e.BuildGetterName(n);t[o]=function(e){t[n]=e,t.detectBoxChanges()},console.log("aa made setter",o),t[i]=function(){return t[n]},null!==r[n]&&void 0!==r[n]&&(t[n]=r[n])})),console.log("aa setup box inputs",t)}},{key:"BuildBoxOutputs",value:function(t,n){Object.keys(n).forEach((function(n){var o=new CustomEvent("(".concat(n,")"),{detail:t}),r="_event_".concat(n);t[r]=o,t[e.BuildPrefixedFunctionName("dispatch",n)]=function(){t.dispatchEvent(t[r])},t[e.BuildPrefixedFunctionName("add","".concat(n,"Listener"))]=function(e){t.addEventListener("(".concat(n,")"),e,!1)},t[e.BuildPrefixedFunctionName("remove","".concat(n,"Listener"))]=function(){t.removeEventListener("(".concat(n,")"),callback)}}))}},{key:"BuildBoxStandardVariables",value:function(e){var t="SharedBoxCore.loadedBoxes.get('".concat(e._name,"').get('").concat(e._boxId,"')");e._context=t}},{key:"LoadDOMAttributes",value:function(t){if(t.attributes){var n=t.constructor._BoxInterface;if(n)for(var o=0;o<t.attributes.length;o++){var r=t.attributes.item(o),i=r.name,a=r.value,u=e.TrimFirstAndLastChar(i);if(e.IsVariableInputProperty(i)&&n.Inputs&&n.Inputs[u]){console.log("aa name",u);var c=e.BuildSetterName(u);"function"==typeof t[c]&&(t[u]=r.value)}else if(e.IsOutputProperty(i)&&n.Outputs&&n.Outputs[u])!function(){var n=e.GetFunctionNameFromFunctionCallString(a),o=t.getParentBox();t.addEventListener(i,(function(e){return o[n](e)}))}();else{var l=e.BuildSetterName(i);console.log("aa found setter!",t[l]),"function"==typeof t[l]&&(t[i]=r.value,console.log("aa value set!",t[i]))}}}}},{key:"IsVariableInputProperty",value:function(e){if(e&&e.length)return e.length>2&&"["===e[0]&&"]"===e[e.length-1]}},{key:"GetFunctionNameFromFunctionCallString",value:function(e){}},{key:"IsOutputProperty",value:function(e){if(e&&e.length)return e.length>2&&"("===e[0]&&")"===e[e.length-1]}},{key:"TrimFirstAndLastChar",value:function(e){var t=e;return e&&e.length>2&&(t=t.slice(1,e.length-1)),t}},{key:"AddBoxToLoadedBoxes",value:function(e){var t=e.constructor._BoxConfig;SharedBoxCore.loadedBoxes.get(t.name)||SharedBoxCore.loadedBoxes.set(t.name,new Map),SharedBoxCore.loadedBoxes.get(t.name).set(e._boxId,e)}}],null&&r(t.prototype,null),n&&r(t,n),e}();function u(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}i(a,"IsNullOrEmpty",(function(e){return"string"==typeof e?!e.length:"object"!==n(e)||!Object.keys(e||{}).length}));var c=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)};function l(e){return(l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function f(e,t){return(f=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function d(e,t){return!t||"object"!==l(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function p(e){return(p=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}u(c,"Document",function(){return null}||function(){return null}),u(c,"Window",function(){return null}||function(){return null}),u(c,"LoadDOM",(function(e,t){c.Window=e,c.Document=t}));var y=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&f(e,t)}(u,e);var t,n,o,r,i=(o=u,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=p(o);if(r){var n=p(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return d(this,e)});function u(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),i.call(this)}return t=u,(n=[{key:"connectedCallback",value:function(){var e=this,t=this.constructor._BoxConfig;this._boxId=SharedBoxCore.getNewBoxId(t),this.id=this._boxId,this._name=t.name,t.styleSheetPath&&BoxLoader.LoadStylesheet(t.styleSheetPath),a.BuildBoxStandardVariables(this),a.BuildBoxInterfaces(this),a.DisplayBox(this),this.detectBoxChanges=function(){return a.DisplayBox(e)},"function"==typeof this.boxOnDisplayed&&this.boxOnDisplayed(),a.AddBoxToLoadedBoxes(this),this._init=!0}},{key:"getParentBox",value:function(){return c.Document.getElementById(this._parentBoxId)}},{key:"terminateSelf",value:function(){this._container.remove(),"function"==typeof this.boxOnDestroyed&&this.boxOnDestroyed()}},{key:"getBoxElementById",value:function(e){return c.Document.getElementById("".concat(this._boxId,"-").concat(e))}},{key:"disconnectedCallback",value:function(){"function"==typeof this.boxOnDestroyed&&this.boxOnDestroyed()}}])&&s(t.prototype,n),u}(c.Window.HTMLElement||function(){return null});function x(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function b(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var B=function(){function e(){var t=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),b(this,"BoxInstanceFactory",(function(e){var n=BoxUtils.CapitalizeFirstLetter(e);return new(t.BoxRegistry.get(n))})),b(this,"CreateBoxContainer",(function(e){var t=e.constructor._BoxConfig,n=c.Document.createElement("div");return n.setAttribute("id",e._boxId),n.setAttribute("class",t.name),n}))}var t,n;return t=e,n=[{key:"SetBoxRegistry",value:function(e){if(!e)throw new Error("BoxJs: Fatal, no box registry specified.");this.BoxRegistry=e}},{key:"BuildBoxesCustomElementRegistry",value:function(){this.BoxRegistry.forEach((function(e){if(!e._BoxConfig)throw new Error('BoxJS: _BoxConfig not present on: "'.concat(e,'"'));var t=e._BoxConfig;t&&(c.Window.customElements.define(t.name,e),console.log('BoxJS: Defined: "'.concat(t.name,'"')))}))}},{key:"GetNewBoxId",value:function(t){var n=0;return e.loadedBoxes.get(t.name)&&(n=e.loadedBoxes.get(t.name).size),"".concat(t.name,"-").concat(n)}}],null&&x(t.prototype,null),n&&x(t,n),e}();b(B,"LoadedBoxes",new Map),b(B,"BoxRegistry",new Map),b(B,"Init",(function(){B.BuildBoxesCustomElementRegistry(),c.Document.getElementById("root").innerHTML="<box-main></box-main>"})),b(B,"AddBoxToDOM",(function(e,t){var n=c.Document.getElementById(t),o=e.constructor._BoxConfig,r=B.GetNewBoxId(o);e._boxId=r,e._name=o.name,BoxUtils.AddBoxToLoadedBoxes(e),BoxUtils.BuildBoxInterfaces(e),BoxUtils.BuildBoxStandardVariables(e),o.styleSheetPath&&BoxLoader.LoadStylesheet(o.styleSheetPath);var i=B.CreateBoxContainer(e);if(e._container=i,BoxUtils.DisplayBox(e),t){if(!n)throw new Error('BoxJS: Cannot add box to null parent. "'.concat(t,'"'));n.appendChild(i)}return e.detectBoxChanges=function(){return BoxUtils.DisplayBox(e)},"function"==typeof e.boxOnDisplayed&&e.boxOnDisplayed(),e._init=!0,e})),b(B,"MakeBox",(function(e,t){var n=B.BoxInstanceFactory(e);return n._className=e,n._parentBoxId=t,B.AddBoxToDOM(n,t)}));var v=require("express"),h=require("express-favicon"),m=require("path"),g=process.env.PORT||2021;const O={Box:y,BoxCore:B,startBoxServer:function(e){var t=v(),n=e+"/public",o=e+"/dist";console.log("HyperBox: starting up application..."),t.use(h(n+"/favicon.ico")),t.use(v.static(o)),t.get("*",(function(e,t){t.sendFile(m.resolve(o,"index.html"))})),t.listen(g,(function(){console.log("HyperBox: application running on port ".concat(g," 🚀"))}))}};return t})()}));
//# sourceMappingURL=index.js.map